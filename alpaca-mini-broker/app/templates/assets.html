{% extends "base.html" %}
{% block content %}
<div class="card shadow-sm">
  <div class="card-body">
    <h5 class="card-title">Assets</h5>
    <div class="input-group mb-3">
      <input id="q" class="form-control" placeholder="Cerca simbolo o nome (es. NVDA)">
      <button class="btn btn-outline-secondary" id="btn">Cerca</button>
    </div>
    <div id="result"></div>
  </div>
</div>
<script>
  async function run(query="") {
    const url = query ? `/api/assets?query=${encodeURIComponent(query)}` : '/api/assets';
    const resp = await fetch(url);
    const data = await resp.json();
    const rows = data.map(a => `<tr><td><button class='btn btn-sm btn-outline-primary' onclick=\"setOrderSymbol('${a.symbol}')\">Usa</button> ${a.symbol}</td><td>${a.name||""}</td><td><span class=\"badge bg-secondary badge-mono\">${a.exchange||""}</span></td><td>${a.tradeable}</td></tr>`).join("");
    document.getElementById('result').innerHTML = `<div class="table-responsive"><table class="table table-sm table-striped">
      <thead><tr><th>Symbol</th><th>Name</th><th>Exchange</th><th>Tradeable</th></tr></thead>
      <tbody>${rows}</tbody></table></div>`;
  }
  document.getElementById('btn').addEventListener('click', ()=> run(document.getElementById('q').value));
  run();
</script>
{% endblock %}